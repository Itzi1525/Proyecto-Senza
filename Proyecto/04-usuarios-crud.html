<script>
    const API_URL = ''; // Local

    document.addEventListener('DOMContentLoaded', cargarUsuarios);

    async function cargarUsuarios() {
        const res = await fetch(`${API_URL}/usuarios`);
        const usuarios = await res.json();
        const tbody = document.getElementById('userTableBody');
        tbody.innerHTML = '';
        usuarios.forEach(u => {
            tbody.innerHTML += `
                <tr>
                    <td>${u.id_usuario}</td>
                    <td>${u.nombre}</td>
                    <td>${u.correo}</td>
                    <td>${u.rol}</td>
                    <td>
                        <button class="btn delete" onclick="eliminarUsuario(${u.id_usuario})">Borrar</button>
                    </td>
                </tr>`;
        });
    }

    document.getElementById('userForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const nombre = document.getElementById('nombre').value;
        const correo = document.getElementById('correo').value;
        const password = document.getElementById('password').value;
        const rol = document.getElementById('rolSelect').value;

        if(!password) return alert("Contraseña obligatoria");

        // AHORA USA LA RUTA CORRECTA PARA CREAR ADMINS
        const res = await fetch(`${API_URL}/api/usuarios`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ nombre, correo, password, rol }) 
        });

        const data = await res.json();
        if(data.success) { 
            alert("Usuario creado");
            document.getElementById('userForm').reset();
            cargarUsuarios(); 
        } else {
            alert("Error: " + data.message);
        }
    });

    window.eliminarUsuario = async (id) => {
        if(!confirm("¿Eliminar usuario?")) return;
        const res = await fetch(`${API_URL}/usuarios/delete`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id })
        });
        if((await res.json()).success) cargarUsuarios();
    };
</script>