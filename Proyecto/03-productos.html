<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Senza - Men√∫ de Productos</title>
<link rel="icon" type="image/png" href="Imagenes\Senza.png">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

    :root { 
        --color-primary: #D2B48C; /* Caf√© claro */
        --color-secondary: #4B3832; /* Caf√© oscuro */
        --color-background: #F8F8F8; /* Blanco muy sutil */
        --color-card-bg: #FFFFFF; /* Blanco puro para las tarjetas */
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--color-background);
        color: var(--color-secondary);
        margin: 0;
        padding: 0;
    }

    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 40px;
        background-color: var(--color-card-bg);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        position: relative; /* Necesario para la barra de b√∫squeda */
    }

    .logo h1 {
        font-size: 1.5em;
        margin: 0;
        font-weight: 600;
    }

    .main-nav ul {
        display: flex;
        list-style: none;
        gap: 20px;
        padding: 0;
        margin: 0;
    }

    .main-nav a {
        text-decoration: none;
        color: var(--color-secondary);
        font-weight: 600;
        transition: color 0.3s ease;
    }

    .main-nav a:hover {
        color: var(--color-primary);
    }

    /* Barra de b√∫squeda */
    .search-bar {
        width: 300px;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }

    .search-bar input {
        width: 100%;
        padding: 10px 15px;
        border-radius: 20px;
        border: 1px solid var(--color-primary);
        background-color: transparent;
        font-family: 'Poppins', sans-serif;
        color: var(--color-secondary);
    }

    .search-bar input::placeholder {
        color: #A0A0A0;
    }
    
    .category-nav {
        background-color: var(--color-background);
        padding: 15px 40px;
        text-align: center;
    }

    .category-nav ul {
        display: flex;
        justify-content: center;
        list-style: none;
        padding: 0;
        margin: 0;
        gap: 30px;
    }

    .category-nav a {
        text-decoration: none;
        color: var(--color-secondary);
        font-weight: 600;
        padding: 8px 15px;
        border-radius: 20px;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .category-nav a.active {
        background-color: var(--color-secondary);
        color: var(--color-card-bg);
    }

    .category-nav a:hover {
        background-color: var(--color-secondary);
        color: var(--color-card-bg);
    }

    .container {
        padding: 30px;
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
    }

    .product-card {
        background-color: var(--color-card-bg);
        border-radius: 10px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .product-card.hidden {
        display: none;
    }

.product-image {
    width: 100%;
    height: 200px;
    background-color: var(--color-primary); /* Mantiene el fondo caf√© */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Evita que la imagen se salga del cuadro */
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* La imagen se ajusta al tama√±o sin deformarse */
}


    .product-content {
        padding: 20px;
    }

    .product-content h3 {
        margin: 0 0 5px 0;
        font-size: 1.2em;
        font-weight: 600;
    }

    .product-content .price {
        font-weight: 700;
        font-size: 1.1em;
        margin-bottom: 15px;
    }

    .btn-add-to-cart {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--color-secondary);
        background-color: transparent;
        color: var(--color-secondary);
        border-radius: 5px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .btn-add-to-cart:hover {
        background-color: var(--color-secondary);
        color: var(--color-card-bg);
    }
    
    /* Modal (ventana flotante) */
        .modal {
            display: none; /* Oculto por defecto */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--color-card-bg); /* Fondo blanco para la ventana emergente */
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        .modal-content h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .modal-content p {
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .modal-content a {
            text-decoration: none;
            color: var(--color-secondary);
            font-weight: 600;
        }

        .modal-content a:hover {
            text-decoration: underline;
        }

        .modal-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: var(--color-secondary);
        }
</style>
</head>
<body>
<header>
    <div class="logo">
        <h1>Senza</h1>
    </div>
    
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Buscar productos...">
    </div>
    
    <nav class="main-nav">
        <ul>
            <li><a href="Inicio.html">Inicio</a></li>
            <li><a href="03-productos.html">Men√∫</a></li>
            
            <li><a href="#" id="accountLink">Cuenta</a></li>

            <li id="logoutItem" style="display: none;">
                <a href="#" id="logoutLink" style="color: #e74c3c;"><i class="fas fa-sign-out-alt"></i> Salir</a>
            </li>
            
            <li><a href="Carrito.html">Carrito</a></li>
        </ul>
    </nav>
</header>

<div class="category-nav">
    <ul>
        <li><a href="#" class="filter-btn active" data-category="all">Todos</a></li>
        <li><a href="#" class="filter-btn" data-category="panaderia">Panader√≠a</a></li>
        <li><a href="#" class="filter-btn" data-category="pasteles">Pasteles</a></li>
        <li><a href="#" class="filter-btn" data-category="galletas">Galletas</a></li>
        <li><a href="#" class="filter-btn" data-category="bebidas">Bebidas</a></li>
    </ul>
</div>

<main class="container">
<div class="productsGrid" id="productsGrid"
    data-id="${p.id_producto}"
    data-nombre="${p.nombre}"
    data-precio="${p.precio}"
    data-category="${p.categoria}">

</main>


<div id="accountModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-icon">&#x1F464;</div> <h2>¬°Hola de nuevo!</h2>
        <p>¬øQu√© te gustar√≠a hacer?</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <a href="Login.html" class="btn-add-to-cart" style="width: auto;">Iniciar Sesi√≥n</a>
            <a href="RegUsu.html" class="btn-add-to-cart" style="width: auto;">Registrarse</a>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {

    fetch('/api/productos')
        .then(res => res.json())
        .then(productos => {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';

            productos.forEach(p => {
                grid.innerHTML += `
                    <div class="product-card"
                        data-id="${p.id_producto}"
                        data-name="${p.nombre}"
                        data-category="${p.categoria}">

                        <div class="product-image">
                            <img src="${p.imagen}" alt="${p.nombre}">
                        </div>

                        <div class="product-content">
                            <h3>${p.nombre}</h3>
                            <p>${p.descripcion}</p>
                            <p class="price">$${p.precio}</p>
                            <button class="btn-add-to-cart">
                                Agregar al carrito
                            </button>
                        </div>
                    </div>
                `;
            });

            activarBotonesCarrito();
        });
});


document.addEventListener('DOMContentLoaded', () => {

    // ==========================================
    // 1. L√ìGICA DE USUARIO (NOMBRE Y LOGOUT)
    // ==========================================
    const nombreUsuario = localStorage.getItem('usuarioNombre');
    const rolUsuario = localStorage.getItem('usuarioRol');

    const accountLink = document.getElementById('accountLink');
    const accountModal = document.getElementById('accountModal');
    const logoutItem = document.getElementById('logoutItem');
    const logoutLink = document.getElementById('logoutLink');

    if (nombreUsuario && accountLink) {
        // SI EST√Å LOGUEADO:
        // 1. Ponemos su nombre
        const primerNombre = nombreUsuario.split(" ")[0];
        accountLink.textContent = "Hola, " + primerNombre;
        
        // 2. Cambiamos el link para que no abra el modal, sino que vaya al perfil (opcional)
        // O simplemente quitamos el evento de abrir modal.
        // Aqu√≠ clonamos el nodo para eliminar el evento de click anterior si existiera
        const newLink = accountLink.cloneNode(true);
        accountLink.parentNode.replaceChild(newLink, accountLink);
        newLink.href = "Perfil.html"; // O '#' si no tienes perfil a√∫n

        // 3. Mostramos el bot√≥n de salir
        if (logoutItem) logoutItem.style.display = 'block';

    } else {
        // SI NO EST√Å LOGUEADO:
        // Mantenemos la l√≥gica del Modal
        if (accountLink && accountModal) {
            accountLink.addEventListener('click', e => {
                e.preventDefault();
                accountModal.style.display = 'flex';
            });
    
            window.addEventListener('click', e => {
                if (e.target === accountModal) {
                    accountModal.style.display = 'none';
                }
            });
        }
    }

    // L√≥gica de Cerrar Sesi√≥n (Correcta, sin borrar rese√±as)
    if (logoutLink) {
        logoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            if(confirm("¬øDeseas cerrar sesi√≥n?")) {
                localStorage.removeItem('usuarioNombre');
                localStorage.removeItem('usuarioRol');
                window.location.href = "Login.html";
            }
        });
    }
    /* =======================
       FILTRO POR CATEGOR√çA
    ======================= */
    const filterButtons = document.querySelectorAll('.filter-btn');
    const productCards = document.querySelectorAll('.product-card');

    filterButtons.forEach(button => {
        button.addEventListener('click', e => {
            e.preventDefault();
            filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            const category = button.dataset.category;
            productCards.forEach(card => {
                const productCategory = card.dataset.category;
                card.classList.toggle(
                    'hidden',
                    !(category === 'all' || productCategory === category)
                );
            });
        });
    });

    /* =======================
       AGREGAR AL CARRITO
    ======================= */
document.addEventListener('click', function (e) {

    if (!e.target.classList.contains('btn-add-to-cart')) return;

    const card = e.target.closest('.product-card');

    const id_producto = card.dataset.id;
    const nombre = card.dataset.nombre;
    const precio = parseFloat(card.dataset.precio);

    if (!id_producto || !nombre || !precio) {
        alert('Producto inv√°lido');
        return;
    }

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    let producto = cart.find(p => p.id_producto == id_producto);

    if (producto) {
        producto.cantidad += 1;
    } else {
        cart.push({
            id_producto: id_producto,
            nombre: nombre,
            precio: precio,
            cantidad: 1
        });
    }

    localStorage.setItem('cart', JSON.stringify(cart));

    alert('üõí Producto agregado al carrito');
});
    /* =======================
       IR A DETALLE DEL PRODUCTO
    ======================= */
    const productImages = document.querySelectorAll('.product-image');

    productImages.forEach(imageContainer => {
        imageContainer.style.cursor = "pointer"; 

        imageContainer.addEventListener('click', () => {
            const card = imageContainer.closest('.product-card');

            // 1. OBTENER DATOS
            const id = card.dataset.id; 
            const nombre = card.querySelector('h3').innerText;
            const precio = card.querySelector('.price').textContent.replace('$','').trim();
            const imagenSrc = card.querySelector('img').src;
            
            const descripcionElement = card.querySelector('p');
            const descripcion = descripcionElement ? descripcionElement.innerText : "";

            // 2. CREAR URL
            const url = `DetalleProducto.html?id=${id}&nombre=${encodeURIComponent(nombre)}&precio=${encodeURIComponent(precio)}&img=${encodeURIComponent(imagenSrc)}&desc=${encodeURIComponent(descripcion)}`;
            
            // 3. REDIRIGIR
            window.location.href = url;
        });
    });

});
</script>

<script src="buscador.js"></script>

</body>
</html>