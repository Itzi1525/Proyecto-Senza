<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Perfil - Senza</title>

    <!-- CSS GLOBAL (el mismo que las demás páginas) -->
    <link rel="stylesheet" href="inventario.css">

    <!-- FUENTE -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="icon" type="image/png" href="Imagenes/Senza.png">
</head>

<body>

<!-- ================= HEADER (IGUAL AL DE INICIO) ================= -->
<header>
    <div class="logo">
        <img src="Imagenes/Senza.png" alt="Senza Logo">
        <h1>Senza</h1>
    </div>

    <div class="search-bar">
        <input type="text" placeholder="Buscar productos...">
    </div>

    <nav class="main-nav">
        <ul>
            <li><a href="Inicio.html">Inicio</a></li>
            <li><a href="03-productos.html">Menú</a></li>

            <li id="adminPanelLi" style="display:none;">
                <a href="AdminOpera.html" class="admin-btn">Panel de Gestión</a>
            </li>

            <li><a href="#" id="accountLink">Cuenta</a></li>

            <li id="logoutItem" style="display:none;">
                <a href="#" id="logoutLink" style="color:#e74c3c;">Salir</a>
            </li>
        </ul>
    </nav>
</header>

<!-- ================= CONTENIDO PERFIL ================= -->
<main class="container">
    <div class="card perfil-card">
        <h2>Mi Perfil</h2>

        <label>Nombre</label>
        <input type="text" id="nombre">

        <label>Correo</label>
        <input type="email" id="correo">

        <label>Teléfono</label>
        <input type="text" id="telefono">

        <button id="btnGuardar">Guardar cambios</button>
    </div>
</main>

<!-- ================= JS PERFIL ================= -->
<script>
/* ---------- VALIDAR SESIÓN ---------- */
const usuarioId = localStorage.getItem('usuarioId');
const nombreUsuario = localStorage.getItem('usuarioNombre');
const rolUsuario = localStorage.getItem('usuarioRol');

if (!usuarioId) {
    window.location.href = 'Login.html';
}

/* ---------- HEADER DINÁMICO ---------- */
const accountLink = document.getElementById('accountLink');
const adminPanelLi = document.getElementById('adminPanelLi');
const logoutItem = document.getElementById('logoutItem');
const logoutLink = document.getElementById('logoutLink');

if (nombreUsuario) {
    accountLink.textContent = nombreUsuario.split(" ")[0];
    accountLink.href = "Perfil.html";
    logoutItem.style.display = 'block';

    if (rolUsuario === 'Administrador' || rolUsuario === 'Operador') {
        adminPanelLi.style.display = 'block';
    }
}

logoutLink.addEventListener('click', () => {
    localStorage.clear();
    window.location.href = 'Login.html';
});

/* ---------- CARGAR DATOS PERFIL ---------- */
fetch(`/api/perfil/${usuarioId}`)
    .then(res => res.json())
    .then(data => {
        document.getElementById('nombre').value = data.nombre || '';
        document.getElementById('correo').value = data.correo || '';
        document.getElementById('telefono').value = data.telefono || '';
    });

/* ---------- GUARDAR CAMBIOS ---------- */
document.getElementById('btnGuardar').addEventListener('click', async () => {
    const body = {
        id: usuarioId,
        nombre: document.getElementById('nombre').value,
        correo: document.getElementById('correo').value,
        telefono: document.getElementById('telefono').value
    };

    const res = await fetch('/api/perfil', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
    });

    const data = await res.json();

    if (data.success) {
        alert('Perfil actualizado correctamente');
        localStorage.setItem('usuarioNombre', body.nombre);
    } else {
        alert('Error al actualizar perfil');
    }
});
</script>

</body>
</html>

